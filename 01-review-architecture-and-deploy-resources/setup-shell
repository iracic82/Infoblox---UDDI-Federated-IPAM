#!/bin/bash

#
# Instruqt Setup Script – UDDI IPAM + Multi-Cloud Discovery
#

echo "🚀 Starting setup script for UDDI IPAM lab..."
set -euxo pipefail

set-workdir /root/infoblox-lab
cd /root/infoblox-lab/uddi-ipam/scripts || {
    echo "❌ Failed to enter /root/infoblox-lab/uddi-ipam/scripts"
    exit 1
}

# Initial CSP sandbox propagation buffer
echo "⏳ Waiting 8 minutes for CSP sandbox propagation..."
sleep 480

# === Discovery Deployments ===
#echo "📦 Deploying AWS discovery..."
#python3 deploy_aws_discovery_final.py
#sleep 120

#echo "📦 Deploying Azure discovery..."
#python3 deploy_azure_discovery.py
#sleep 120

echo "📦 Deploying GCP discovery..."
python3 deploy_gcp_discovery.py
sleep 120

# === IPAM and API Key ===
echo "🧠 Deploying IPAM configuration..."
python3 deploy_ipam.py
sleep 30

echo "🔐 Deploying API key..."
python3 deploy_api_key.py

# Optional: reload bash config
source /root/.bashrc || true

echo "✅ Setup complete and ready."
exit 0