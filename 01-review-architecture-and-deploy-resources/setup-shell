#!/bin/bash

#
# Instruqt Setup Script â€“ UDDI IPAM + Multi-Cloud Discovery
#

echo "ğŸš€ Starting setup script for UDDI IPAM lab..."
set -euxo pipefail

set-workdir /root/infoblox-lab
cd /root/infoblox-lab/uddi-ipam/scripts || {
    echo "âŒ Failed to enter /root/infoblox-lab/uddi-ipam/scripts"
    exit 1
}

# Initial CSP sandbox propagation buffer
echo "â³ Waiting 8 minutes for CSP sandbox propagation..."
sleep 480

# === Discovery Deployments ===
#echo "ğŸ“¦ Deploying AWS discovery..."
#python3 deploy_aws_discovery_final.py
#sleep 120

#echo "ğŸ“¦ Deploying Azure discovery..."
#python3 deploy_azure_discovery.py
#sleep 120

echo "ğŸ“¦ Deploying GCP discovery..."
python3 deploy_gcp_discovery.py
sleep 120

# === IPAM and API Key ===
echo "ğŸ§  Deploying IPAM configuration..."
python3 deploy_ipam.py
sleep 30

echo "ğŸ” Deploying API key..."
python3 deploy_api_key.py

# Optional: reload bash config
source /root/.bashrc || true

echo "âœ… Setup complete and ready."
exit 0